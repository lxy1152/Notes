---
title: 304.二维区域和检索-矩阵不可变
date: 2021-03-02 13:07:41
description: 二维前缀和的应用
katex: true
cover: https://images.unsplash.com/photo-1578431603273-095b7e2a60b2?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=2121&q=80
tags:
  - 数组
  - 前缀和
categories:
  - LeetCode
  - 题解
  - LeetCode
  - 0301-0400
abbrlink: af07095c
---

## 题目信息

### 题目描述

给定一个二维矩阵，计算其子矩形范围内元素的总和，假设该子矩阵的左上角为 `row1`，`col1`，右下角为 `row2`，`col2`。

### 示例输出

假设输入矩阵为：

$$
\def\arraystretch{1.5}
   \begin{array}{|c|c|c|c|c|}
   \hline 
   3 & 0 & 1 & 4 & 2 \\ \hline
   5 & 6 & 3 & 2 & 1 \\ \hline
   1 & 2 & 0 & 1 & 5 \\ \hline
   4 & 1 & 0 & 1 & 7 \\ \hline
   1 & 0 & 3 & 0 & 5 \\ \hline
\end{array}
$$

依次调用 `sumRegion` 函数：

* sumRegion(2, 1, 4, 3)
* sumRegion(1, 1, 2, 2)
* sumRegion(1, 2, 2, 4)

输出：`[null, 8, 11, 12]`

## 解题思路

本题类似于 [303.区域和检索-数组不可变](/cbb5d165)，但是是前缀和在二维数组的应用。

## 代码实现

``` java
/**
 * 本题使用的数据结构<br>
 * 通过这个数据结构应该能够快速得到矩阵中某子矩阵的元素和
 *
 * @author lixiangyu
 */
class NumMatrix {
    /**
     * 保存前缀和的数组
     */
    private int[][] preSum;

    /**
     * 默认构造器, 在这里需要对矩阵做特殊处理(计算前缀和), 尽量降低查找时的时间复杂度,
     * 最好画图来理解(其实就是计算面积)
     *
     * @param matrix 一个矩阵
     */
    public NumMatrix(int[][] matrix) {
        // 注意题目在这里并没有保证行数一定大于0
        int m = matrix.length;
        if (m > 0) {
            int n = matrix[0].length;
            preSum = new int[m + 1][n + 1];
            // 为了避免在索引0处的特殊处理, 将i, j统一做加1处理
            for (int i = 1; i <= m; i++) {
                for (int j = 1; j <= n; j++) {
                    preSum[i][j] = preSum[i - 1][j] + preSum[i][j - 1] - preSum[i - 1][j - 1] + matrix[i - 1][j - 1];
                }
            }
        }
    }

    /**
     * 得到某子矩阵的元素和
     *
     * <p>
     * 思路:<br>
     * 一维数组还可以暴力破解, 二维矩阵就不太可能了, 类似{@link SolutionQ303}的思路, 计算矩阵中每个子矩阵的前缀和
     * </p>
     *
     * @param row1 第一个元素所在的行
     * @param col1 第一个元素所在的列
     * @param row2 第二个元素所在的行
     * @param col2 第二个元素所在的列
     * @return 这个子矩阵的元素和
     */
    public int sumRegion(int row1, int col1, int row2, int col2) {
        return this.preSum[row2 + 1][col2 + 1] - this.preSum[row1][col2 + 1]
                - this.preSum[row2 + 1][col1] + this.preSum[row1][col1];

    }
}
```

---
